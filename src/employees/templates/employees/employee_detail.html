{% extends "content.html" %}
{% load static %}
{% load workify_tags %}

{% block main %}
<div class="container">
    <div class="row">
        <div class="col-lg">
            {% if employee.avatar %}
            <img src="{{ employee.avatar.url }}" alt="" class="img-thumbnail">
            {% endif %}
        </div>
        <div class="col-lg">
            <div class="row">
                <div class="col">First name:</div>
                <div class="col">{{ employee.user.first_name}}</div>
            </div>
            <div class="row">
                <div class="col">Last name:</div>
                <div class="col">{{ employee.user.last_name}}</div>
            </div>
            <div class="row">
                <div class="col">Email:</div>
                <div class="col"><a href="mailto:{{ employee.user.email}}">{{ employee.user.email}}</a></div>
            </div>
            <div class="row">
                <div class="col">Tax ID:</div>
                <div class="col">{{ employee.tax_id}}</div>
            </div>
            <div class="row">
                <div class="col">Groups:</div>
                <div class="col">
                    {% for group in employee.user.groups.all %}
                    <span class="badge bg-primary">{{ group }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="row">
                <div class="col">Documents:</div>
                <div class="col"><a href="#documents_section" >[{{ employee.employeedocument_set.count }}]</a></div>
            </div>
            <div class="row">
                <div class="col">Rates:</div>
                <div class="col"><a href="#rates_section" >[{{ employee.employeerate_set.count }}]</a></div>
            </div>
            <div class="row">
                <div class="col">Time reports:</div>
                <div class="col">[todo] TR count and link</div>
            </div>
        </div>
    </div>
</div>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom" id="documents_section">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb h2">
        Documents
      </ol>
    </nav>          
    {% if user_can_change_employee %}
    <div class="btn-toolbar mb-2 mb-md-0">
      {% render_button new_document_button %}
    </div>
    {% endif %}
</div>
<table class="table table-striped align-middle table-hover">
    <thead>
        <tr>
            <th scope="col" >#</th>
            <th scope="col" >Name</th>
            <th scope="col" >Signature day</th>
            <th scope="col" >Type</th>      
            {% if user_can_change_employee %}
            <th scope="col" >Comment</th>
            {% endif %}
            <th scope="col" >Reference</th>
            <th scope="col" ></th>
        </tr>
    </thead>
    <tbody>
        {% for document in documents %}
        <tr scope="row">
            <td>{{forloop.counter}}</td>
            <td>{{ document.name }}</td>
            <td>{{ document.sign_date }}</td>
            <td>{{ document.get_document_type_display }}</td>
            {% if user_can_change_employee %}
            <td>
                {% if document.comment %}
                {{ document.comment }}
                {% endif %}
            </td>
            {% endif %}
            <td>
                {% if document.reference_document %}
                <a href="{{document.reference_document.document_file.url}}">{{ document.reference_document }}</a> 
                <a href="{{document.reference_document.document_file.url}}"><span data-feather="external-link"></span></a> 
                {% endif %}
            </td>
            <td>                
                <div class="btn-toolbar d-flex justify-content-end" role="toolbar">
                  {% render_button document.buttons %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom" id="rates_section">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb h2">
        Rates
      </ol>
    </nav>          
      
    {% if user_can_change_employee %}
    <div class="btn-toolbar mb-2 mb-md-0">
      {% render_button new_rate_button  %}
    </div>
    {% endif %}
</div>
<table class="table table-striped align-middle table-hover">
    <thead>
        <tr>
            <th scope="col" >#</th>
            <th scope="col" >Type</th>
            <th scope="col" >Chargable</th>
            <th scope="col" >Internal</th>
            <th scope="col" >Currency</th>
            <th scope="col" >Valid from</th>
            <th scope="col" >Valid to</th>            
            {% if user_can_change_employee %}
            <th scope="col" >Comment</th>
            {% endif %}
            <th scope="col" >Document</th>
            <th scope="col" > </th>
        </tr>
    </thead>
    <tbody>
        {% for rate in rates %}
        <tr scope="row">
            <td>{{ forloop.counter }}</td>
            <td>{{ rate.get_rate_type_display }}</td>
            <td>{{ rate.chargable_rate }}</td>
            <td>{{ rate.basic_rate }}</td>
            <td>{{ rate.currency }}</td>
            <td>{{ rate.valid_from }}</td>
            <td>
                {% if rate.valid_to %}
                    {{ rate.valid_to }}
                {% else %}
                    -
                {% endif %}
            </td>
            {% if user_can_change_employee %}
            <td>{{ rate.comment }}</td>
            {% endif %}
            <td>
                
                {% if rate.reference_document %}
                <a href="{{rate.reference_document.document_file.url}}">{{ rate.reference_document }}</a> 
                <a href="{{rate.reference_document.document_file.url}}"><span data-feather="external-link"></span></a> 
                {% endif %}
            </td>
            <td>                
                <div class="btn-toolbar d-flex justify-content-end" role="toolbar">
                    {% render_button rate.buttons %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}